{
    "contents" : "rm(list=ls())\nsource(\"./util.R\")\n\ntarget = \"Comparison_in_ex\"#'pubmed_ex'\n#mkdir(paste(\"../../result/Comparison_in_ex/overlap/\",sep=\"\"))###\nmkdir(paste(\"../../result/\",target,\"/overlap/\",sep=\"\"))###\n\n\nin.file <- \"inclusion\"#\"inclusion\",'pubmed'\nex.file <- \"exclusion\"\nsource.file.in <-c(paste(\"../../result/\",in.file,\"/allData_table\",sep = \"\"))\nsource.file.ex <-c(paste(\"../../result/\",ex.file,\"/allData_table\",sep = \"\"))\nsource.file.st.in <-c(paste(\"../../result/\",in.file,\"/allST_sep\",sep = \"\"))\nsource.file.st.ex <-c(paste(\"../../result/\",ex.file,\"/allST_sep\",sep = \"\"))\n\nall.in <- read.table(source.file.in,sep='\\t',header = T,row.names=NULL)\nall.ex <- read.table(source.file.ex,sep='\\t',header = T,row.names=NULL)\nall.st.in <- read.table(source.file.st.in,sep='\\t',row.names=NULL)\nall.st.ex <- read.table(source.file.st.ex,sep='\\t',row.names=NULL)\n\nin.id1<-all.in[,1]\nin.DiseaseName<-all.in[,2]\nin.CDE<-all.in[,3]\nin.Freq<-all.in[,4]\nin.st <-all.in[,5]\nex.id1<-all.ex[,1]\nex.DiseaseName<-all.ex[,2]\nex.CDE<-all.ex[,3]\nex.Freq<-all.ex[,4]\nex.st<-all.ex[,5]\n\n#output combined ST list\n#out.list.st<-c(paste('../../result/allST_combine',sep=''))\n#st <- union(all.st.ex$V1,all.st.in$V1)\n#write.table(st,out.list.st,row.names=F,col.names=F,quote=F)\n\ntotal.id<- union(in.DiseaseName,ex.DiseaseName)\n\ncompare.plot.overlap<-function(st=x.axis.group.overall,in.st=x.axis.group.in,ex.st=x.axis.group.ex){\n  cde.num.ST.in<-list()\n  for (st1 in st){\n    cde.candi.in <- in.CDE[grepl(st1, in.st)] \n    cde.num.ST.in[[st1]] <- unique(cde.candi.in)\n  }\n  cde.num.ST.ex<-list()\n  for (st1 in st){\n    cde.candi.ex <- ex.CDE[grepl(st1, ex.st)] \n    cde.num.ST.ex[[st1]] <- unique(cde.candi.ex)\n  }\n  #generate dataset for plotting\n  for.plot <- data.frame(st=\"\",section=\"\",stringsAsFactors=F)\n  j=0\n  for (st1 in st){\n    inter <- length(intersect(cde.num.ST.ex[[st1]],cde.num.ST.in[[st1]]))\n    for (i in 0:(inter-1)){\n      j = j+1\n      add<-c(st1,\"Intersect\")\n      for.plot[j,]<-add\n    }\n    unique.in <-length(cde.num.ST.in[[st1]])-inter\n    for (i in 0:(unique.in-1)){\n      j = j+ 1\n      add<-c(st1,in.file)#\"Inclusion\"\n      for.plot[j,]<-add\n    }\n    unique.ex <-length(cde.num.ST.ex[[st1]])-inter\n    for (i in 0:(unique.ex-1)){\n      j=j+1\n      add<-c(st1,\"Exclusion\")\n      for.plot[j,]<-add\n    } \n  }\n  return (for.plot)\n}\n\nlibrary(ggplot2)\n#disease\nout.pdf.discription <- c(paste('../../result/',target,'/overlap/In_Ex_compare_disease.pdf',sep=''))\npdf(out.pdf.discription)\nout.table1<-c(paste('../../result/',target,'/overlap/In_Ex_compare_disease_table',sep=''))\n\nx.axis.group.overall = total.id\nx.axis.group.in = in.DiseaseName\nx.axis.group.ex = ex.DiseaseName\nfor.plot<-compare.plot.overlap(x.axis.group.overall,x.axis.group.in,x.axis.group.ex)\nwrite.table(for.plot,out.table1,sep=\"\\t\",row.names=F,col.names=F,quote=F)\n\nmyPalette<-c('chocolate1','palegreen3','skyblue2')\nk<-qplot(reorder(for.plot$st,for.plot$section,length), data = for.plot,geom = \"histogram\", fill = section,xlab='Mental Disorders',ylab='CEF counts',main='Overlapping between Exclusion/Inclusion CEFs')\nk + theme(axis.text.x = element_text(family = \"\",face=\"bold\",colour=\"black\",size=4,angle=45,vjust=1,hjust=1))+scale_fill_manual(values=myPalette)# + scale_fill_brewer()\ndev.off()\n\n#ST\nlibrary(ggplot2)\nout.table2 <- c(paste(\"../../result/\",target,\"/overlap/In_Ex_compare_st_table\",sep=''))\nout.pdf.discription2 <- c(paste('../../result/',target,'/overlap/In_Ex_compare_st.pdf',sep=''))\npdf(out.pdf.discription2)\n\nx.axis.group.overall = st\nx.axis.group.in = in.st\nx.axis.group.ex = ex.st\nfor.plot<-compare.plot.overlap(x.axis.group.overall,x.axis.group.in,x.axis.group.ex)\nwrite.table(for.plot,out.table2,sep=\"\\t\",row.names=F,col.names=F,quote=F)\n\nk<-qplot(st, data = for.plot,geom = \"histogram\", fill = section)\nk + theme(axis.text.x = element_text(family = \"\",face=\"bold\",colour=\"black\",size=8,angle=45,vjust=1,hjust=1)) #+ scale_fill_brewer()\ndev.off()",
    "created" : 1411417461876.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3996678317",
    "id" : "13BD50EC",
    "lastKnownWriteTime" : 1395012103,
    "path" : "~/Dropbox/research/chunhua project/common eligibility feature/src/rlib/Comparison_overlap.R",
    "project_path" : "Comparison_overlap.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}